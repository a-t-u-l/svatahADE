<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="Behaviour driven automation platform" />
    <meta name="author" content="svatah" />

    <title>Svatah ADE</title>
    <!-- Bootstrap core CSS     -->
    <link href="./../css/bootstrap.min.css?v=1.0.5" rel="stylesheet" />
    <!--  Material Dashboard CSS    -->
    <link href="./../css/black-dashboard.css?v=1.1.45455" rel="stylesheet" />
    <!--     Fonts and icons     -->
    <link href="./../css/font-awesome.min.css" rel="stylesheet" type='text/css' />
    <link href='./../css/material-icons-fonts.css' rel='stylesheet' type='text/css' />
    <link href="./../css/poppins-fonts.css" rel="stylesheet" />
    <link href="./../css/svatah.css" rel="stylesheet" />

    <style type="text/css">
        .buttonload {
            background-color: #4CAF50;
            /* Green background */
            border: none;
            /* Remove borders */
            color: white;
            /* White text */
            padding: 12px 24px;
            /* Some padding */
            font-size: 16px;
            /* Set a font-size */
        }

        /* Add a right margin to each icon */
        .fa {
            margin-left: -12px;
            margin-right: 8px;
        }

        #jsoneditor {
            height: 800px;
        }
    </style>
</head>

<body id="bod" class="white-content">
    <div class="wrapper" style="border-top: 2px solid #e6b31c;">
        <div id="sidebar" class="sidebar" data-color="orange" data-image="#">
            <div class="logo">
                <a href="./home.html" target="_blank" class="simple-text logo-mini">
                    S
                </a>
                <a href="./home.html" target="_blank" class="simple-text logo-normal">
                    Svatah
                </a>
            </div>
            <div class="sidebar-wrapper">
                <ul class="nav">

                    <li class="project active">
                        <a href="./project.html" data-toggle="tooltip" data-placement="right" title="project">
                            <i class="material-icons">assessment</i>
                            <p>View Projects</p>
                        </a>
                    </li>

                    <li class="newuiproject">
                        <a href="./newproject.html" data-toggle="tooltip" data-placement="right" title="newproject">
                            <i class="material-icons">note_add</i>
                            <p>New Project</p>
                        </a>
                    </li>

                    <!-- <li class="newapiproject">
                        <a href="./apiproject.html" data-toggle="tooltip" data-placement="right" title="newproject">
                            <i class="material-icons">description</i>
                            <p>New API Project</p>
                        </a>
                    </li> -->

                    <li class="api-client">
                        <a href="./apiclient.html" data-toggle="tooltip" data-placement="right" title="API client">
                            <i class="material-icons">extension</i>
                            <p>API Client</p>
                        </a>
                    </li>

                    <li class="results">
                        <a href="./results.html" data-toggle="tooltip" data-placement="right" title="results">
                            <i class="material-icons">receipt</i>
                            <p>Results</p>
                        </a>
                    </li>

                    <li class="docs">
                        <a href="https://www.svatah.in/docs" target="_blank" data-toggle="tooltip" data-placement="right"
                            title="View docs" id="docsLink">
                            <i class="material-icons">description</i>
                            <p>Docs</p>
                        </a>
                    </li>

                    <li id="darkmode" class="theme">
                        <a class="toggle-label toggle-label-off" data-toggle="tooltip" data-placement="right"
                            title=" toggle dark mode">
                            <i id="darkmodeicon" class="material-icons">toggle_on</i>
                            <p>darkmode</p>
                        </a>
                    </li>

                </ul>
            </div>
        </div>
        <div class="main-panel">
            <div class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-2 nav flex-column nav-pills" id="v-pills-tab" role="tablist">
                            <a class="nav-link active" id="v-pills-config-tab" data-toggle="pill" href="#v-pills-config"
                                role="tab" aria-controls="v-pills-config" aria-selected="true">CONFIG</a>
                            <div class="cross-page-line"></div>
                            <a class="nav-link" id="v-pills-profile-tab" data-toggle="pill" href="#v-pills-profile"
                                role="tab" aria-controls="v-pills-profile" aria-selected="false">DATA REPOSITORY</a>
                            <div class="cross-page-line"></div>
                            <a class="nav-link" id="v-pills-messages-tab" data-toggle="pill" href="#v-pills-messages"
                                role="tab" aria-controls="v-pills-messages" aria-selected="false">LOCATOR REPOSITORY</a>
                            <div class="cross-page-line"></div>
                            <a class="nav-link" id="v-pills--add-flow-tab" data-toggle="pill" href="#v-pills-add-flow"
                                role="tab" aria-controls="v-pills-add-flow" aria-selected="false">ADD FLOW</a>
                            <div class="cross-page-line"></div>
                        </div>

                        <div class="hidden-for-mobile">
                            <div class="cross-page-line d-lg-none d-md-none d-xl-none"></div>
                        </div>
                        <div class="col-md-10">
                            <div class="row">
                                <div id="alertbar" class="col-md-12">

                                </div>
                            </div>
                            <div class="form-horizontal" id="project">
                                <div class="tab-content" id="v-pills-tabContent">
                                    <div class="col-md-12 tab-pane fade show active" id="v-pills-config" role="tabpanel"
                                        aria-labelledby="v-pills-config-tab">

                                        <div class="card">
                                            <div class="card-header">
                                                <h4 class="card-title">Project Configuration</h4>
                                                <h6 class="card-title">define your project configuration. You can
                                                    define
                                                    more
                                                    configurations later for different builds.</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-group">
                                                            <input id="name" name="name" type="text"
                                                                placeholder="Project Name" class="form-control" value=""
                                                                required />
                                                            <small id="nameHelp" class="form-text text-muted">Enter
                                                                your
                                                                project's
                                                                name
                                                            </small>
                                                        </div>
                                                    </div>

                                                    <div class="col-md-6">
                                                        <div class="form-group">
                                                            <input id="configName" name="configName" type="text"
                                                                placeholder="Config Name" class="form-control" value=""
                                                                required />
                                                            <small id="configNameHelp" class="form-text text-muted">
                                                                Enter a
                                                                unique config name. This will be used later for your
                                                                builds.
                                                            </small>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <input id="url" name="url" type="text"
                                                                placeholder="http://www.svatah.com" class="form-control"
                                                                value="" required />
                                                            <small id="urlHelp" class="form-text text-muted">Enter a
                                                                valid
                                                                url
                                                            </small>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-md-4">
                                                        <div class="form-group">
                                                            <select class="form-control" id="browser" name="browser"
                                                                type="text">
                                                                <option value="chrome">chrome</option>
                                                                <option value="firefox">firefox</option>
                                                            </select>
                                                            <small id="browserHelp" class="form-text text-muted">Choose
                                                                a
                                                                browser
                                                            </small>
                                                        </div>
                                                    </div>

                                                    <div class="col-md-4">
                                                        <div class="form-group">
                                                            <select class="form-control" id="takeStepScreenshot"
                                                                name="takeStepScreenshot" type="text">
                                                                <option value="false">false</option>
                                                                <option value="true">true</option>
                                                            </select>
                                                            <small id="takeStepScreenshotHelp"
                                                                class="form-text text-muted">
                                                                Choose
                                                                whether to take screenshot at each step
                                                            </small>
                                                        </div>
                                                    </div>

                                                    <div class="col-md-4">
                                                        <div class="form-group">
                                                            <select class="form-control" id="threadCount"
                                                                name="threadCount" type="text">
                                                                <option value="1">1</option>
                                                                <option value="2">2</option>
                                                                <option value="3">3</option>
                                                                <option value="4">4</option>
                                                                <option value="5">5</option>
                                                                <option value="6">6</option>
                                                                <option value="7">7</option>
                                                                <option value="8">8</option>
                                                            </select>
                                                            <small id="threadHelp" class="form-text text-muted">Enter
                                                                numbers of
                                                                executors which needs to get picked.
                                                            </small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-12 tab-pane fade" id="v-pills-profile" role="tabpanel"
                                        aria-labelledby="v-pills-profile-tab">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="card text-left">
                                                    <div id="dataAlert" class="alert-danger" hidden="hidden">
                                                        <span>Data field/s can not have empty key or value!</span>
                                                    </div>
                                                    <div class="card-header">
                                                        <h4 class="card-title">Data repository</h4>
                                                        <h6 class="card-title">The data table fields are editable.
                                                            You
                                                            would
                                                            need to save the changes before submitting the flow.
                                                        </h6>
                                                    </div>
                                                    <div class="card-body">
                                                        <div id="table" class="table-editable">
                                                            <table class="table table-bordered table-responsive-md">
                                                                <tr class="table-active">
                                                                    <th style="font-weight: normal;">Variable Name</th>
                                                                    <th style="font-weight: normal;">Variable Value</th>
                                                                    <th></th>
                                                                </tr>
                                                                <!-- This is our clonable table line -->
                                                                <tr class="hide" hidden="hidden">
                                                                    <td contenteditable="true"></td>
                                                                    <td contenteditable="true"></td>
                                                                    <td>
                                                                        <span class="table-remove">
                                                                            <button type="button" rel="tooltip"
                                                                                title="Delete"
                                                                                class="btn btn-danger btn-link btn-sm">
                                                                                <i class="material-icons">delete</i>
                                                                            </button>
                                                                        </span>
                                                                    </td>
                                                                </tr>
                                                                <!-- ------------------------------- -->


                                                            </table>
                                                            <span id="addDataRow" class="table-add mb-3 mr-2">
                                                                <button type="button" rel="tooltip" title="Add"
                                                                    class="btn btn-yellow btn-link btn-sm"><i
                                                                        class="material-icons">add</i>
                                                                </button>
                                                            </span>
                                                            <span class="export-btn mb-3 mr-2">
                                                                <button type="button" disabled="true" rel="tooltip"
                                                                    title="Export"
                                                                    class="btn btn-yellow btn-link btn-sm save-btn"><i
                                                                        class="material-icons">save</i>
                                                                </button>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <input id="dataField" name="dataFile" type="text"
                                                        class="form-control" value="" hidden="hidden" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-12 tab-pane fade" id="v-pills-messages" role="tabpanel"
                                        aria-labelledby="v-pills-messages-tab">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="card text-left">
                                                    <div id="locatorAlert" class="alert-danger" hidden="hidden">
                                                        <span>Locator field/s can not have empty key or
                                                            value!</span>
                                                    </div>
                                                    <div class="card-header">
                                                        <h4 class="card-title">Locator repository</h4>
                                                        <h6 class="card-title">The locator table fields are
                                                            editable.
                                                            You
                                                            would
                                                            need to save the changes before submitting the flow.
                                                        </h6>
                                                    </div>
                                                    <div class="card-body">
                                                        <div id="locator-table" class="table-editable">
                                                            <table class="table table-bordered table-responsive-md">
                                                                <tr class="table-active">
                                                                    <th style="font-weight: normal;">Locator Identifier
                                                                    </th>
                                                                    <th style="font-weight: normal;">Locator Details
                                                                    </th>
                                                                    <th></th>
                                                                </tr>
                                                                <!-- This is our clonable table line -->
                                                                <tr class="hide" hidden="hidden">
                                                                    <td contenteditable="true"></td>
                                                                    <td contenteditable="true"></td>
                                                                    <td>
                                                                        <span class="locator-table-remove">
                                                                            <button type="button" rel="tooltip"
                                                                                title="Delete"
                                                                                class="btn btn-danger btn-link btn-sm">
                                                                                <i class="material-icons">delete</i>
                                                                            </button>
                                                                        </span>
                                                                    </td>
                                                                </tr>
                                                                <!-- ------------------------------- -->


                                                            </table>
                                                            <span class="locator-table-add mb-3 mr-2">
                                                                <button type="button" rel="tooltip" title="Add"
                                                                    class="btn btn-yellow btn-link btn-sm"><i
                                                                        class="material-icons">add</i>
                                                                </button>
                                                            </span>
                                                            <span class="locator-export-btn mb-3 mr-2">
                                                                <button type="button" disabled="true" rel="tooltip"
                                                                    title="Export"
                                                                    class="btn btn-yellow btn-link btn-sm locator-save-btn"><i
                                                                        class="material-icons">save</i>
                                                                </button>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <input id="locatorEditor" name="locatorFile" type="text"
                                                        class="form-control" value="" hidden="hidden" />
                                                </div>
                                            </div>

                                        </div>
                                    </div>

                                    <div class="col-md-12 tab-pane fade" id="v-pills-add-flow" role="tabpanel"
                                        aria-labelledby="v-pills-add-flow">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="card">
                                                    <div class="card-header">
                                                        <h4 class="card-title">User Journey Flows</h4>
                                                        <h6 class="card-title">Define your tests here using svatah
                                                            flow
                                                            specification.
                                                            A Single flow defines the one continuous path of journey
                                                            user
                                                            takes through the website.</h6>
                                                    </div>
                                                    <div class="card-body">
                                                        <div class="form-group">
                                                            <div class="col-md-12">
                                                                <input id="flowFileName" name="flowFileName" type="text"
                                                                    placeholder="Flow File Name" class="form-control"
                                                                    value="" required />
                                                                <small id="flowFileNameHelp"
                                                                    class="form-text text-muted">Enter flow
                                                                    file name
                                                                </small>
                                                            </div>
                                                        </div>

                                                        <div id="TextBoxesGroup">
                                                            <div class="form-group">
                                                                <div class="col-md-12">
                                                                    <textarea id="txtEditor" name="flowFile"
                                                                        style="min-width: 100%"
                                                                        placeholder="Define you test flow here."
                                                                        rows="10" required></textarea>
                                                                    <textarea id="txtEditorContent"
                                                                        name="txtEditorContent" hidden="">
                                                                    </textarea>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <span class="table-add mb-3 mr-2">
                                                            <button type="button" rel="tooltip" title="Add"
                                                                class="btn btn-yellow btn-link btn-sm"><i
                                                                    class="material-icons">add</i>
                                                            </button>
                                                        </span>
                                                        <span class="table-add mb-3 mr-2">
                                                            <button rel="tooltip"
                                                                class="remove-btn btn btn-yellow btn-link btn-sm"
                                                                name="removeFlow" value="0" data-toggle="tooltip"
                                                                data-placement="top" title="Delete"><i
                                                                    class="material-icons">delete</i>
                                                            </button>
                                                        </span>
                                                        <span class="table-add mb-3 mr-2">
                                                            <button type="button" rel="tooltip" title="run"
                                                                onclick="runTest()"
                                                                class="btn btn-yellow btn-link btn-sm"><i
                                                                    class="material-icons">play_arrow</i>
                                                            </button>
                                                        </span>
                                                    </div>
                                                    <div class="card-footer">

                                                        <span class="table-add mb-3 mr-2 pull-right">
                                                            <button id="create-project-button" onclick="createProject()"
                                                                class="btn btn-success add-new-flow-btn"><i
                                                                    id="buttonLoader"></i>
                                                                Create Project
                                                            </button>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <footer class="footer">
                        <p class="copyright pull-right">
                            &copy;
                            <script>
                                document.write(new Date().getFullYear())
                            </script>
                            <a href="./home.html" target="_blank">Svatah</a>, Behaviour Driven Automation Platform
                        </p>
                    </footer>
                </div>
            </div>
        </div>
    </div>
</body>

<!--   Core JS Files   -->
<script>if (typeof module === 'object') { window.module = module; module = undefined; }</script>
<script src="./../js/jquery.min.js?v=3.4.0.1" type="text/javascript"></script>
<script src="./../js/popper.min.js?v=1.0.2" type="text/javascript"></script>
<script src="./../js/bootstrap.min.js?v=1.0.2" type="text/javascript"></script>
<script src="./../js/perfect-scrollbar.jquery.min.js?v=1.0.1"></script>
<!-- Material Dashboard javascript methods -->
<script src="./../js/black-dashboard.js?v=1.0.14"></script>
<script src="./../js/svatah.js"></script>
<script src="./../js/jquery.textcomplete.js?v=1.0.0" type="text/javascript"></script>
<script>if (window.module) module = window.module;</script>

<script>
    function runTest() {
        let validation = validateInputNotEmpty('name', 'alertbar', 'Project name can not be empty.');
        if (validation) {
            showAlert('alertbar', 'info', 'Starting project validation and exection ...')
            let data = JSON.parse($('#dataField').val());
            //console.log('got data : '+ data);
            let dataMap = {};
            for (let i = 0; i < data.length; i++) {
                let varObj = data[i];
                //console.log('var obj : '+varObj);
                let varKey = varObj['variable name'];
                let varVal = varObj['variable value'];
                dataMap[varKey] = varVal;
                //console.log(varKey + ' : ' + varVal);
            }

            let locatorData = JSON.parse($('#locatorEditor').val());
            //console.log('got data : '+ data);
            let locatorMap = {};
            for (let i = 0; i < locatorData.length; i++) {
                let varObj = locatorData[i];
                //console.log('var obj : '+varObj);
                let varKey = varObj['locator identifier'];
                let varVal = varObj['locator details'];
                locatorMap[varKey] = varVal;
                //console.log(varKey + ' : ' + varVal);
            }

            let flowFlieName = $('#flowFileName').val();
            let flowFile = $('#txtEditor').val();
            let floObj = {}
            floObj[flowFlieName] = flowFile;
            let request = {
                "url": $('#url').val(),
                "browser": $('#browser').val(),
                "threadCount": $('#threadCount').val(),
                "executionId": 1,
                "takeStepScreenshot": $('#takeStepScreenshot').val(),
                "variableDataMap": dataMap,
                "locatorTagAndLocatorMap": locatorMap,
                "systemPropertyMap": { "screenWidth": "1920", "screenHeight": "1080" },
                "scenarioFiles": floObj
            }

            console.log('request : ' + JSON.stringify(request));

            $.ajax({
                type: "POST",
                url: 'http://localhost:8095/test',
                data: JSON.stringify(request),
                contentType: "application/json;charset=utf-8",
                success: function (gotResponse) {
                    console.log(gotResponse);
                    showAlert('alertbar', 'success', 'your project is good to go.')
                },
                error: function (gotResponse) {
                    showAlert('alertbar', 'danger', gotResponse.responseJSON.body)
                    console.log(gotResponse);
                },
                dataType: 'json'
            });
        }
    }


    function createProject() {
        let validation = validateInputNotEmpty('name', 'alertbar', 'Project name can not be empty.');
        if (validation) {
            $('#buttonLoader').addClass('fa fa-spinner fa-spin');
            let dbClient = require('./../js/dbclient.js');
            console.log($('#name').val() + ' , ' + $('#browser').val() + ' , ' +
                $('#threadCount').val() + ' , ' + $('#url').val() + ' , ' + $('#takeStepScreenshot').val()
                + ' , ' + $('#dataField').val() + ' , ' + '1920x1080');
            dbClient.insertConfigRow($('#configName').val(), $('#browser').val(), $('#threadCount').val(), $('#url').val(),
                $('#name').val(), $('#takeStepScreenshot').val(), $('#dataField').val(), '1920x1080');
            dbClient.insertProjectRow($('#name').val(), $('#locatorEditor').val(), $('#configName').val());
            dbClient.insertFlowRow($('#txtEditor').val(), $('#flowFileName').val(), $('#name').val());
            $('#buttonLoader').removeClass('fa fa-spinner fa-spin');
            window.location.href = "./viewproject.html";
        }
    }
</script>

<script>
    var $LOCATOR_TABLE = $('#locator-table');
    var $LOCATOR_BTN = $('#locator-export-btn');

    $('.locator-table-add').click(function () {
        var $clone = $LOCATOR_TABLE.find('tr.hide').clone(true).removeClass('hide table-line');
        $LOCATOR_TABLE.find('table').append($clone.prop("hidden", false));
        $('.locator-save-btn').prop("disabled", false);
        //$('.add-new-flow-btn').prop("disabled", true);
    });

    $('.locator-table-remove').click(function () {
        $(this).parents('tr').detach();
        $('.locator-save-btn').prop("disabled", false);
        //$('.add-new-flow-btn').prop("disabled", true);
    });

    $LOCATOR_TABLE.on("click", 'tr td', function () {
        $('.locator-save-btn').prop("disabled", false);
        //$('.add-new-flow-btn').prop("disabled", true);
    });

    $('.locator-export-btn').click(function () {
        var $rows = $LOCATOR_TABLE.find('tr:not(:hidden)');
        var headers = [];
        var data = [];

        // Get the headers (add special header logic here)
        $($rows.shift()).find('th:not(:empty)').each(function () {
            headers.push($(this).text().toLowerCase());
        });

        // Turn all existing rows into a loopable array
        $rows.each(function () {
            var $td = $(this).find('td');
            var h = {};

            // Use the headers from earlier to name our hash keys
            headers.forEach(function (header, i) {
                h[header] = $td.eq(i).text();
            });

            data.push(h);
        });

        // Output the result
        var flag = true;
        for (member in data) {
            for (field in data[member]) {
                if (data[member][field] == '') {
                    flag = false;
                    break;
                }
                if (!flag) {
                    break;
                }
            }
            if (!flag) {
                break;
            }
        }
        if (flag) {
            //console.log(JSON.stringify(data));
            $("#locatorEditor").val(JSON.stringify(data));
            $("#locatorAlert").prop("hidden", true);
            $('.locator-save-btn').prop("disabled", true);
            //$('.add-new-flow-btn').prop("disabled", false);
        }
        else {
            $("#locatorAlert").prop("hidden", false);
        }
        flag = true;
    });
</script>

<script>
    var $TABLE = $('#table');
    var $BTN = $('#export-btn');
    var $EXPORT = $('#export');

    $('#addDataRow').click(function () {
        var $clone = $TABLE.find('tr.hide').clone(true).removeClass('hide table-line');
        $TABLE.find('table').append($clone.prop("hidden", false));
        $('.save-btn').prop("disabled", false);
        //$('.add-new-flow-btn').prop("disabled", true);
    });

    $('.table-remove').click(function () {
        $(this).parents('tr').detach();
        $('.save-btn').prop("disabled", false);
        //$('.add-new-flow-btn').prop("disabled", true);
    });

    // A few jQuery helpers for exporting only
    jQuery.fn.pop = [].pop;
    jQuery.fn.shift = [].shift;

    $('.export-btn').click(function () {
        var $rows = $TABLE.find('tr:not(:hidden)');
        var headers = [];
        var data = [];

        // Get the headers (add special header logic here)
        $($rows.shift()).find('th:not(:empty)').each(function () {
            headers.push($(this).text().toLowerCase());
        });

        // Turn all existing rows into a loopable array
        $rows.each(function () {
            var $td = $(this).find('td');
            var h = {};

            // Use the headers from earlier to name our hash keys
            headers.forEach(function (header, i) {
                h[header] = $td.eq(i).text();
            });

            data.push(h);
        });

        // Output the result
        var flag = true;
        for (member in data) {

            for (field in data[member]) {
                if (data[member][field] == '') {
                    flag = false;
                    break;
                }
                if (!flag) {
                    break;
                }
            }
            if (!flag) {
                break;
            }
        }
        if (flag) {
            //console.log(JSON.stringify(data));
            $("#dataField").val(JSON.stringify(data));
            $("#dataAlert").prop("hidden", true);
            $('.save-btn').prop("disabled", true);
            //$('.add-new-flow-btn').prop("disabled", false);
        }
        else {
            $("#dataAlert").prop("hidden", false);
        }
        flag = true;
    });

    $TABLE.on("click", 'tr td', function () {
        $('.save-btn').prop("disabled", false);
        //$('.add-new-flow-btn').prop("disabled", true);
    });

    $('.save-btn').click(function () {
        if ($('.locator-save-btn').attr('disabled') == 'disabled') {
            $('.add-new-flow-btn').prop('disabled', false);
            $("#flowSaveAlert").prop("hidden", true);
        }
        else {
            $('.add-new-flow-btn').prop('disabled', true);
            $("#dataAlert").prop("hidden", false);
        }
    });

    $('.locator-save-btn').click(function () {
        if ($('.save-btn').attr('disabled') == 'disabled') {
            $('.add-new-flow-btn').prop('disabled', false);
            $("#flowSaveAlert").prop("hidden", true);
        }
        else {
            $('.add-new-flow-btn').prop('disabled', true);
            $("#locatorAlert").prop("hidden", false);
        }
    });

    $('.add-new-flow-btn').on('click', function () {
        //console.log("checking btn validation . save btn " + $('.save-btn').attr('disabled'));
        //console.log("checking btn validation . locator save btn " + $('.locator-save-btn').attr('disabled'));
        if ($('.save-btn').attr('disabled') == 'disabled' && $('.locator-save-btn').attr('disabled') == 'disabled')
            $('.add-new-flow-btn').prop('disabled', false);
        else {
            //console.log("user needs to save repository");
            $('.add-new-flow-btn').prop('disabled', true);
            $("#flowSaveAlert").prop("hidden", false);
        }
    });
</script>

<script>
    $(document).ready(function () {
        {
            let locatorRows = $('#locator-table').find('tr');
            let dataRows = $('#table').find('tr');

            $("#locatorEditor").val(JSON.stringify(getFieldVal(locatorRows)));
            $("#dataField").val(JSON.stringify(getFieldVal(dataRows)));
        }
    });

    function getFieldVal($rows) {
        var headers = [];
        var data = [];
        // Get the headers (add special header logic here)
        $($rows.shift()).find('th:not(:empty)').each(function () {
            headers.push($(this).text().toLowerCase());
        });
        //console.log('headers : '+ JSON.stringify(headers));
        // Turn all existing rows into a loopable array
        $rows.each(function () {
            var $td = $(this).find('td');
            var h = {};

            // Use the headers from earlier to name our hash keys
            headers.forEach(function (header, i) {
                h[header] = $td.eq(i).text();
            });

            data.push(h);
        });
        return data;
    }

    $('textarea').textcomplete([
        { // actions
            id: 'intent',
            words: ['clicks', 'click', 'clears', 'clear', 'get text', 'copy text', 'save text', 'getText', 'types', 'type', 'submits', 'click enter', 'submit', 'dismiss alert', 'dismisses alert', 'dismissAlert', 'accept alert', 'accepts alert', 'acceptAlert', 'waits', 'sleep', 'sleeps', 'waiting', 'wait', 'assert selected', 'check selected', 'is selected', 'assertSelected', 'assert not selected', 'is not selected', 'assertNotSelected', 'assert displayed', 'isDisplayed', 'is displayed', 'assertDisplayed', 'assert not displayed', 'is not displayed', 'assertNotDisplayed', 'assert enabled', 'is enabled', 'is not disabled', 'assertEnabled', 'assert disabled', 'is disabled', 'is not enabled', 'assertDisabled', 'assert element present', 'is element present', 'assertElementPresent', 'assert alert present', 'is alert present', 'assertAlertPresent', 'assert alert not present', 'is alert not present', 'assertAlertNotPresent', 'validate text', 'validates text', 'verifyText', 'verify text', 'validateText', 'contains text', 'validate contains text', 'verify contains text', 'verifyContainsText', 'validateContainsText', 'validate tag name', 'verifyTagName', 'verify tag name', 'validateTagName', 'validate attribute value', 'verifyAttributeValue', 'verify attribute value', 'validateAttributeValue', 'validate location', 'verifyLocation', 'verify location', 'validateLocation', 'validate dimension', 'verifyDimension', 'verify dimension', 'validateDimension', 'validate rectangle', 'verifyRectangle', 'verify rectangle', 'validateRectangle', 'accept the alert and validate alert text', 'accept the alert and validate displayed text', 'acceptAndValidateAlertText', 'reject the alert and validate alert text', 'reject the alert and validate displayed text', 'rejectAndValidateAlertText', 'invoke', 'call', 'hit', 'invoke without cookies', 'call without cookies', 'hit without cookies', 'selectByVisibleText', 'select by visible text', 'select by shown text', 'select', 'selectByIndex', 'select by index', 'selectByValue', 'select by value', 'select by sent value', 'deselectAll', 'deselect all', 'remove all selections', 'deselectByVisibleText', 'deselect by visible text', 'deselect by shown text', 'deselect', 'deselectByIndex', 'deselect by index', 'deselectByValue', 'deselect by value', 'deselect by sent value', 'assertMultipleSelectionSupported', 'assert multiple selection is supported', 'validate multiple selection is supported', 'assertMultipleSelectionNotSupported', 'assert multiple selection is not supported', 'validate multiple selection is not supported', 'scrollIntoView', 'scroll into view', 'scroll to view', 'scrollToBottom', 'scroll to bottom', 'scroll to page bottom', 'scroll to bottom of the page', 'scrollToTop', 'scroll to top', 'scroll to page top', 'scroll to top of the page', 'explicitWaitForElementPresence', 'wait for the presence', 'explicitWaitForElementVisibility', 'wait for the visibility'],
            match: /\+\b(\w{1,})$/,
            search: function (term, callback) {
                callback($.map(this.words, function (word) {
                    return word.indexOf(term) === 0 ? word : null;
                }));
            },
            index: 1,
            replace: function (word) {
                return '+' + word + '+ ';
            }
        },

        { // actions
            id: 'identity',
            words: function () {
                let wordArr = [];
                let locatorString = $("#locatorEditor").val();
                //console.log('locator : '+ locatorString);
                if (locatorString != null && locatorString != '') {
                    let locators = JSON.parse(locatorString);
                    if (Array.isArray(locators)) {
                        locators.forEach(function (item, index) {
                            wordArr.push(item['locator identifier']);
                        });
                    }
                    else {
                        console.log('locator set not defined');
                    }
                }
                return wordArr;
            },
            match: /\~\b(\w{1,})$/,
            search: function (term, callback) {
                callback($.map(this.words(), function (word) {
                    return word.indexOf(term) === 0 ? word : null;
                }));
            },
            index: 1,
            replace: function (word) {
                return '~' + word + '~ ';
            }
        },

        { // actions
            id: 'input',
            words: function () {
                let wordArr = [];
                dataString = $("#dataField").val();
                //console.log('data : '+ dataString);
                if (dataString != null && dataString != '') {
                    let data = JSON.parse(dataString);
                    if (Array.isArray(data)) {
                        data.forEach(function (item, index) {
                            wordArr.push(item['variable name']);
                        });
                    }
                    else {
                        console.log('dataset not defined');
                    }
                }
                return wordArr;
            },
            match: /\*\b(\w{1,})$/,
            search: function (term, callback) {
                callback($.map(this.words(), function (word) {
                    return word.indexOf(term) === 0 ? word : null;
                }));
            },
            index: 1,
            replace: function (word) {
                return '*$' + word + '* ';
            }
        }

    ], {
            onKeydown: function (e, commands) {
                if (e.ctrlKey && e.keyCode === 74) { // CTRL-J
                    return commands.KEY_ENTER;
                }
            }
        });
</script>

</html>